# Инструкция по эксплуатации

## Генерация корневого доверенного сертификата 


Если отсутствует корневой сертификат, то в тестовом режиме можно создать свой:

```
sh ./tls/generate-ca.sh
```

## Генерация ключей сервиса

Далее для самой кафки генерируется пара сервисных ключей, подписанные вышесгенерированным CA:

```
sh ./tls/generate-ssl.sh ./ca kafka
```

В качестве вспомогательного файла настроек используется openssl-<keypair_name>.cnf (где keypair_name - 2й аргумент команды) для описания полей сертификата и его расширений(одно из необходимых - SAN). В SAN должны присутствовать все хосты и IP, используемые брокерами.

## Создание секрета в кластере

Далее необходимо создать секрет в кластере с помощью команды:

```
sh ./tls/generate-secrets.sh kafka kafka
```

или 

```
kubectl create secret generic ${secret_name}-jks -n $namespace --from-file=${name}.truststore.jks=./${secret_name}.truststore.jks --from-file=${name}.keystore.jks=./${secret_name}.keystore.jks
```